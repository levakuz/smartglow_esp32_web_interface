<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    .h1{
      font-family: "Roboto Light",sans-serif;
      font-size: 24px;
      color:  #4C5DB8;
    }
    .div{
      display: flex;
      flex-direction:column;
      align-items: center;
    }
    .styled-table {

    margin: 25px 0;
    font-size: 0.9em;
    font-family: sans-serif;
    min-width: 600px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
  }
  .styled-table thead tr {
  background-color: #4C5DB8;
  color: #ffffff;
  text-align: center;
  }
  .styled-table th,
  .styled-table td {
    padding: 12px 15px;
  }
  .styled-table tbody tr {
    border-bottom: 1px solid #dddddd;
  }

  .styled-table tbody tr:nth-of-type(even) {
    background-color: #f3f3f3;
  }

  .styled-table tbody tr:last-of-type {
    border-bottom: 2px solid #4C5DB8;
  }
  .text{
      font-family: "Roboto Light",sans-serif;
      font-size: 18px;
  }
  .button{
      margin-top: 20px;
      background: #4C5DB8;
      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
      border-radius: 15px;
      width: 120px;
      height: 39px;
      margin-left: 40px;
    }
    #zatemnenie{
        background: rgba(102, 102, 102, 0.5);
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
      }
    #register_device_popup{
        background: rgba(102, 102, 102, 0.5);
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
      }
    #change_device_mode_popup{
        background: rgba(102, 102, 102, 0.5);
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
      }
    #okno {
        width: 300px;
        height: 500px;
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        color: #0000cc;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        background: #fff;
      }
    #register_device_window {
        width: 900px;
        text-align: center;
        align-items: center;
        justify-content: center;
        padding: 15px;
        border-radius: 10px;
        color: #0000cc;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        background: #fff;
      }
    #change_device_mode_window {
        width: 900px;
        text-align: center;
        align-items: center;
        justify-content: center;
        padding: 15px;
        border-radius: 10px;
        color: #0000cc;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        background: #fff;
      }
      #zatemnenie:target {display: block;}
      #register_device_popup:target {display: block;}
      #change_device_mode_popup:target {display: block;}
      .close {
        display: inline-block;
        border: 1px solid #0000cc;
        color: #0000cc;
        padding: 0 12px;
        margin: 10px;
        text-decoration: none;
        background: #f2f2f2;
        font-size: 14pt;
        cursor:pointer;
      }
      .close:hover {background: #e6e6ff;}
  .switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

  /* The slider */
  .slider_round {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
  }

  .slider_round:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
  }

  input:checked + .slider_round {
    background-color: #2196F3;
  }

  input:focus + .slider_round {
    box-shadow: 0 0 1px #2196F3;
  }

  input:checked + .slider_round:before {
    -webkit-transform: translateX(26px);
    -ms-transform: translateX(26px);
    transform: translateX(26px);
  }

  /* Rounded sliders */
  .slider_round {
    border-radius: 34px;
  }

  .slider_round:before {
    border-radius: 50%;
  }
  </style>
  <meta charset="UTF-8">
  <title>SMARTGLOW v.0.1</title>
</head>
<body>
  <div class="div">
    <h1 class="h1" id='id' style="font-size: 24px; align-self: center"> Модуль {}</h1>
  </div>
  <div class="div">
    <table id="unregistered_devices" class="styled-table">
      <caption>
        <div style="display: flex; flex-direction:row; justify-content: center">
          <p style="font-size: 18px">
            Незарегистрированные устройства
          </p>
          <button style="border: none; background-color: white">
            <img src="refresh.png" style="width: 50px; height: 50px">
          </button>
        </div>
      </caption>
      <thead>
        <tr>
            <th>ID</th>
            <th>Тип устройства</th>
            <th>Регистрация устройства</th>
        </tr>
      </thead>
      <tbody>
        <tr>

        </tr>
      </tbody>
    </table>
    <table id="registered_devices" class="styled-table">
      <caption style="align-self: center">
        <div style="display: flex; flex-direction:row; justify-content: center">
          <p style="font-size: 18px">
            Зарегистрированные устройства
          </p>
          <button style="border: none; background-color: white">
            <img src="refresh.png" style="width: 50px; height: 50px">
          </button>
        </div>
      </caption>
      <thead>
        <tr>
            <th>ID</th>
            <th>Имя устройства</th>
            <th>Конфигурация</th>
            <th>Удалить устройство</th>
        </tr>
      </thead>
      <tbody>
        <tr>

        </tr>
      </tbody>
    </table>
  </div>
  <hr style="width: 100%; height:2px; background-color: #4C5DB8"/>
  <h1 class="h1"> Системные настройки</h1>
  <div>
    <div style="display: flex; flex-direction: row;">
      <h2 class="h1">Системное время: </h2>
      <input style="margin-left: 10px; height: 30px; align-self: center" type="datetime-local" name="calendar">
      <input class="button" type="submit" value="Применить">
    </div>
      <div style="display: flex; flex-direction: row;">
        <h2 class="h1">Сетевые настройки</h2>
        <div id="zatemnenie">
          <div id="okno">
            <h2 class="h1">Сетевые настройки</h2>
            <form>
              <div style="display: flex; flex-direction: row;">
                <label for="wifi_name"> Имя точки доступа Wi-Fi</label>
                <input id="wifi_name" type="text" style="height: 30px">
              </div>
              <br/>
              <div style="display: flex; flex-direction: row;">
                <label for="wifi_pass"> Пароль точки доступа Wi-Fi</label>
                <input id="wifi_pass" type="text" style="height: 30px">
              </div>
              <br/>
              <div style="display: flex; flex-direction: row;">
                <label for="broker_ip"> IP MQTT брокера</label>
                <input id="broker_ip" type="text" style="height: 30px">
              </div>
              <br/>
              <div style="display: flex; flex-direction: row;">
                <label for="broker_port"> Порт MQTT брокера</label>
                <input id="broker_port" type="text" style="height: 30px">
              </div>
              <br/>
              <div style="display: flex; flex-direction: row;">
                <label for="broker_username"> Имя пользователя MQTT брокера</label>
                <input id="broker_username" type="text" style="height: 30px">
              </div>
              <br/>
              <div style="display: flex; flex-direction: row;">
                <label for="broker_pass"> Пароль пользователя MQTT брокера</label>
                <input id="broker_pass" type="text" style="height: 30px">
              </div>
              <br/>
              <div style="display: flex; flex-direction: row;">
                <label for="system_time_value"> Частота отправки</label>
                <div style="display: flex; flex-direction: row;">
                  <select  id="system_time_value" style="width: 75px">
                  </select>
                  <select id="system_time_options" style="width: 75px">
                  </select>
                </div>
              </div>
            </form>
            <div style="display: flex; flex-direction: row;">
              <button class="button" onclick="window.location.href='#'">Отменить</button>
              <button class="button" onclick="saveSettings();window.location.href='#'">Сохранить</button>
            </div>
          </div>
        </div>
        <button class="button" onclick="window.location.href='#zatemnenie'">Изменить</button>
      </div>
  </div>
    <div id="register_device_popup">
          <div id="register_device_window">
            <h2 class="h1">Просмотр/Редактирование конфигурации</h2>
            <br/>
            <h2 id="device_id"></h2>
            <br/>
            <div style="align-self: center">
            <div style="display: flex; flex-direction: row;">
              <label for="module_id" style="margin-left: 60px"> Имя устройства управления</label>
              <input id="module_id" type="text" style="height: 20px; margin-left: 50px">
            </div>
            <form>

              <br/>
            </form>
          </div>
        </div>
  </div>
  <div id="change_device_mode_popup">
    <div id="change_device_mode_window">
      <h2 class="h1">Изменение режима работы устройства</h2>
      <br/>
      <br/>
      <div style="align-self: center">
      <form>

        <br/>
      </form>
    </div>
  </div>
  </div>


</body>
<script>

  function fetch_unregistered_devices(){
   fetch("http://192.168.1.51/get_unregistered_devices", { method: 'GET' })
    .then(response => {
        // response.headers.forEach(function(value, name) {
        //     console.log(name + ": " + value);
        // });
        let count_of_devices =  parseInt(response.headers.get('count_of_devices'), 10)
        let device_ids = response.headers.get('device_ids')
        let device_types = response.headers.get('device_types')
        device_ids = device_ids.split(',')
        device_types = device_types.split(',')
        for (let i = 0; i < count_of_devices; i++){
          addRowToUnregisteredDevices(device_ids[i], device_types[i]);
        }
    })
    .catch(function(err) {
        console.info(err + " url: " + "http://localhost/get_unregistered_devices");
    });
  }
  function fetch_registered_devices(){
   fetch("http://192.168.1.51/get_registered_devices", { method: 'GET' })
    .then(response => {
        // response.headers.forEach(function(value, name) {
        //     console.log(name + ": " + value);
        // });
      console.log("get_registered_devices")
        let count_of_devices =  parseInt(response.headers.get('count_of_devices'), 10)
        let device_ids = response.headers.get('device_ids')
        let device_names = response.headers.get('device_names')
        device_ids = device_ids.split(',')
        device_names = device_names.split(',')
        for (let i = 0; i < count_of_devices; i++){
          addRowToRegisteredDevices(device_ids[i], device_names[i]);
        }
    })
    .catch(function(err) {
        console.info(err + " url: " + "http://localhost/get_unregistered_devices");
    });
  }
  fetch_registered_devices()
  fetch_unregistered_devices()
  function fetch_info_registered_device(device_id){
   fetch("http://192.168.1.51/get_info_registered_device", {
     method: 'GET' ,
     // mode: 'no-cors',
     // headers: {
     //  'Access-Control-Allow-Origin': '*',
     //  'Access-Control-Expose-Headers': '*',
     //  'device_id': device_id,
     // }
   }
   )
    .then(response => {
        response.headers.forEach(function(value, name) {
            console.log(name + ": " + value);
        });
        console.log("get_info_registered_device")
        let count_of_devices =  parseInt(response.headers.get('count_of_devices'), 10)
        let device_name = response.headers.get('device_name')
        let count_of_sensor_modules = response.headers.get('count_of_sensor_modules')
        let sensors_names = response.headers.get('sensors_names').split(',')
        let sensor_indications = response.headers.get('sensor_indications').split(',')
        let sensor_values = response.headers.get('sensor_values').split(',')
        let count_of_device_modules = response.headers.get('count_of_device_modules').split(',')
        let count_of_cycles_in_device_moduls = response.headers.get('count_of_cycles_in_device_moduls').split(',')
        let pwm_powers = response.headers.get('pwm_powers').split(';')
        let work_mode = response.headers.get('work_mode').split(',')
        let cycle_begin = response.headers.get('cycle_begin').split(';')
        let cycle_end = response.headers.get('cycle_end').split(';')
        let turn_on = response.headers.get('turn_on').split(';')
        let turn_off = response.headers.get('turn_off').split(';')
        for (let i = 0; i < count_of_sensor_modules; i++){
          console.log(sensor_values[i].split(' '))
          AddSensorDevice(i, sensors_names[i], sensor_indications[i],sensor_values[i])
        }
        for (let i = 0; i < count_of_device_modules; i++){
          console.log(sensor_values[i].split(' '))
          addMechDevice(i, count_of_cycles_in_device_moduls[i], pwm_powers[i], work_mode[i], cycle_begin[i], cycle_end[i], turn_on[i], turn_off[i])
        }
        // device_names = device_names.split(',')
        // for (let i = 0; i < count_of_devices; i++){
        //   addRowToRegisteredDevices(device_ids[i], device_names[i]);
        // }
    })
    // .catch(function(err) {
    //     console.info(err + " url: " + "http://192.168.1.51/get_info_registered_device");
    // });
  }
  fetch_info_registered_device("123")
  let id = "123123"
  document.getElementById('id').innerHTML = 'Модуль: ' + id;
  function addRowToUnregisteredDevices(device_id, device_type) { //добавление записи в таблицу
  // Get a reference to the table
  let tableRef = document.getElementById('unregistered_devices');

  // Insert a row in the table at row index 0
  let newRow = tableRef.insertRow(1);

  // Insert a cell in the row at index 0
  let newCell = newRow.insertCell(0);
  let newCell1 = newRow.insertCell(1);
  let newCell2 = newRow.insertCell(2);

  // Append a text node to the cell
  let newText = document.createTextNode(device_id);
  let newText1 = document.createTextNode(device_type);
  let button = document.createElement("button");
  button.innerHTML = "Зарегистрировать устройство";
  button.style.cssText = "      margin-top: 20px;\n" +
    "      background: #4C5DB8;\n" +
    "      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);\n" +
    "      border-radius: 15px;\n" +
    "      width: 200px;\n" +
    "      height: 39px;\n" +
    "      margin-left: 40px;";
  button.addEventListener ("click", register_new_device);
  newCell.appendChild(newText);
  newCell1.appendChild(newText1);
  newCell2.appendChild(button);
  }

  function addRowToRegisteredDevices(device_id, device_name) { //добавление записи в таблицу
  // Get a reference to the table
  let tableRef = document.getElementById('registered_devices');

  // Insert a row in the table at row index 0
  let newRow = tableRef.insertRow(1);

  // Insert a cell in the row at index 0
  let newCell = newRow.insertCell(0);
  let newCell1 = newRow.insertCell(1);
  let newCell2 = newRow.insertCell(2);
  let newCell3 = newRow.insertCell(3);

  // Append a text node to the cell
  let newText = document.createTextNode(device_id);
  let newText1 = document.createTextNode(device_name);
  let button = document.createElement("button");
  button.innerHTML = "Просмотр/редактирование конфигурации";
  button.style.cssText = "      margin-top: 20px;\n" +
    "      background: #4C5DB8;\n" +
    "      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);\n" +
    "      border-radius: 15px;\n" +
    "      width: 200px;\n" +
    "      height: 39px;\n" +
    "      margin-left: 0px;";
  button.addEventListener ("click", register_new_device);
  let button1 = document.createElement("button");
  button1.innerHTML = "Удалить устройство";
  button1.style.cssText = "      margin-top: 20px;\n" +
    "      background: #4C5DB8;\n" +
    "      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);\n" +
    "      border-radius: 15px;\n" +
    "      width: 200px;\n" +
    "      height: 39px;\n" +
    "      margin-left: 0px;";
  button.addEventListener ("click", register_new_device);
  newCell.appendChild(newText);
  newCell1.appendChild(newText1);
  newCell2.appendChild(button);
  newCell3.appendChild(button1);

  }

  let device_id = 1

  function create_change_device_mode_window(){
    let change_device_mode_window = document.getElementById('change_device_mode_window');
    change_device_mode_window.innerHTML ='';
    window.location.href='#change_device_mode_popup'
    let header = document.createElement("h2")
    header.classList.add("h1")
    change_device_mode_window.appendChild(header)
    header.textContent = "Изменение режима работы устройства"
    let header2 = document.createElement("h2")
    header2.classList.add("h2")
    change_device_mode_window.appendChild(header2)
    header2.textContent = "Имя модуля"
    let table = document.createElement("table");
    table.id = 'sensor_device_table_' + device_id.toString()
    table.classList.add("styled-table");
    table.style = "margin-left: 50px; margin-top: 0px"
    change_device_mode_window.appendChild(table);
    let thead = document.createElement("thead");
    table.appendChild(thead);
    let tr = document.createElement("tr")
    thead.appendChild(tr);
    let th1 = document.createElement("th")
    th1.style="width:200px"
    th1.textContent = "Ручной режим"
    tr.appendChild(th1);
    let th2 = document.createElement("th")
    th2.textContent = "Включить/Выключить устройство"
    tr.appendChild(th2);
    let th3 = document.createElement("th")
    th3.textContent = "Изменить величину регулирования"
    tr.appendChild(th3);
    let tbody = document.createElement("tbody")
    table.appendChild(tbody)
    let tr2 = document.createElement("tr")
    tbody.appendChild(tr2)
    let newRow = table.insertRow(1);
    let newCell = newRow.insertCell(0);
    let newCell1 = newRow.insertCell(1);
    let newCell2 = newRow.insertCell(2);
    let div1 = document.createElement("div")
    newCell.appendChild(div1)
    let switch_label = document.createElement("label")
    switch_label.classList.add("switch")
    div1.appendChild(switch_label)
    let input1 = document.createElement("input")
    input1.type = "checkbox"
    switch_label.appendChild(input1)
    let span = document.createElement("span")
    span.classList.add("slider_round")
    switch_label.appendChild(span)
    let br = document.createElement("br")
    change_device_mode_window.appendChild(br)
    let div2 = document.createElement("div")
    newCell1.appendChild(div2)
    let switch_label2 = document.createElement("label")
    switch_label2.classList.add("switch")
    div2.appendChild(switch_label2)
    let input2 = document.createElement("input")
    input2.type = "checkbox"
    switch_label2.appendChild(input2)
    let span2 = document.createElement("span")
    span2.classList.add("slider_round")
    switch_label2.appendChild(span2)
    let div3 = document.createElement("div")
    newCell2.appendChild(div3)
    let param_input = document.createElement("select");
    param_input.id = "param_input";
    div3.appendChild(param_input)
    let cancel_button = document.createElement("button")
    cancel_button.classList.add("button")
    cancel_button.addEventListener("click",go_back_to_config_window);
    cancel_button.textContent = "Отменить"
    change_device_mode_window.appendChild(cancel_button)
    let save_button = document.createElement("button")
    save_button.classList.add("button")
    save_button.addEventListener("click",saveDeviceMode);
    save_button.textContent = "Сохранить"
    change_device_mode_window.appendChild(save_button)
    fill_pwd_input(param_input.id)
    change_device_mode_window.style.height = "400px"
  }
  function register_new_device() {
     window.location.href='#register_device_popup'
     document.getElementById('device_id').innerHTML = 'Устройство управления группой: ' + device_id;

    // window.location=document.getElementById('button').href;

  }
  function create_config_window(){
    let device_list = [1]
    // AddSensorDevice(1)
    // addMechDevice(1)
    let register_device_window = document.getElementById("register_device_window")
    let div3 = document.createElement("div")
    div3.style = "display: flex; flex-direction: row; justify-content: center"
    register_device_window.appendChild(div3)
    let cancel_button = document.createElement("button")
    cancel_button.classList.add("button")
    cancel_button.addEventListener("click",go_back);
    cancel_button.textContent = "Отменить"
    div3.appendChild(cancel_button)
    let save_button = document.createElement("button")
    save_button.classList.add("button")
    save_button.addEventListener("click",saveSettings);
    save_button.textContent = "Сохранить"
    div3.appendChild(save_button)
    let new_lenght =  device_list.length * 800
    let register_device_popup = document.getElementById("register_device_window")
    register_device_popup.style = "height: " + new_lenght.toString() + "px"
  }
  function go_back(){
    window.location.href='#'
  }
  function go_back_to_config_window(){
    window.location.href='#register_device_popup'
  }

  function AddSensorDevice(device_id,device_name, indication, values){
    let config_window = document.getElementById('register_device_window');
    let div = document.createElement('div');
    let header = document.createElement('h2');
    header.textContent = device_name;
    config_window.appendChild(header);
    let table = document.createElement("table");
    table.id = 'sensor_device_table_' + device_id.toString()
    table.classList.add("styled-table");
    table.style = "margin-left: 50px; margin-top: 0px"
    config_window.appendChild(table);
    let thead = document.createElement("thead");
    table.appendChild(thead);
    let tr = document.createElement("tr")
    thead.appendChild(tr);
    let th1 = document.createElement("th")
    th1.style="width:200px"
    th1.textContent = "Последнее показание"
    tr.appendChild(th1);
    let th2 = document.createElement("th")
    th2.textContent = "Частота отправки"
    tr.appendChild(th2);
    let tbody = document.createElement("tbody")
    table.appendChild(tbody)
    let tr2 = document.createElement("tr")
    tbody.appendChild(tr2)
    let newRow = table.insertRow(1);
    let newCell = newRow.insertCell(0);
    let newCell1 = newRow.insertCell(1);
    let input = document.createElement("select");
    let label = document.createElement("label");
    label.for = "time_value";
    label.style = "margin-right: 10px";
    label.textContent = "Частота отправки";
    input.id = "channel_time_value" + device_id.toString();
    input.type = "text";
    input.list = "time_values" + device_id.toString();
    // console.log(input.list.id)
    let newText1 = document.createTextNode(indication);
    newCell.appendChild(newText1)
    values = values.split(' ')
    input.style = "width: 75px; margin-right: 10px";
    let datalist = document.createElement("datalist");
    datalist.id = "time_values" + device_id.toString();
    let input_time_measure = document.createElement("select");
    input_time_measure.style='width: 75px';
    let input_time_measure_datalist = document.createElement("select");
    input_time_measure_datalist.id = "channel_time" + device_id.toString();
    input_time_measure_datalist.style = "width: 100px";
    let time_type;
    if (values[1] === 'secs'){time_type = 'секунды'}
    if (values[1] === 'mins'){time_type = 'минуты'}
    if (values[1] === 'hours'){time_type = 'часы'}
    console.log(time_type)
    console.log(values[0])
    newCell1.appendChild(div);
    div.appendChild(label);
    div.appendChild(input);
    div.appendChild(datalist);
    div.appendChild(input_time_measure_datalist);
    console.log(input.id)
    console.log(datalist.id)
    fill_time_input(input.id)
    fill_time_type_input(input_time_measure_datalist.id)
    input_time_measure_datalist.value = time_type
    input.value = values[0]

  }
  // AddSensorDevice(1)
  function addMechDevice(i, count_of_cycles_in_device_moduls, pwm_powers, work_mode, cycle_begin, cycle_end, turn_on, turn_off){
    let config_window = document.getElementById('register_device_window');
    let header = document.createElement("h2");
    header.textContent = "Имя модуля";
    let table = document.createElement("table");
    table.id = 'mech_device_table_' + device_id.toString()
    table.classList.add("styled-table");
    table.style = "margin-left: 50px; margin-top: 0px"
    let caption = document.createElement("caption");
    caption.style = "align-self: center";
    let caption_div = document.createElement("div");
    caption_div.style = "display: flex; flex-direction:row; justify-content: center";
    caption.appendChild(caption_div)
    table.appendChild(caption)
    let caption_text = document.createElement("p");
    caption_text.textContent = "Циклы работы"
    caption_text.style = "font-size: 18px;"
    caption_div.appendChild(caption_text);
    let add_row_button = document.createElement("button");
    add_row_button.style = "border: none; background-color: white; margin-left: 10px; margin-right: 400px"
    caption_div.appendChild(add_row_button);
    let add_row_img = document.createElement("img");
    add_row_img.src = "plus-icon.png"
    add_row_img.style = "width: 30px; height: 30px"
    add_row_button.appendChild(add_row_img);
    let refresh_button = document.createElement("button");
    refresh_button.style = "border: none; background-color: white; margin-left: 200px"
    caption_div.appendChild(refresh_button);
    let refresh_img = document.createElement("img");
    refresh_img.src = "refresh.png"
    refresh_img.style = "width: 50px; height: 50px"
    refresh_button.appendChild(refresh_img);
    let thead = document.createElement("thead");
    table.appendChild(thead);
    let tr = document.createElement("tr")
    thead.appendChild(tr);
    let th1 = document.createElement("th")
    th1.style="width:200px"
    th1.textContent = "Степень ШИМ"
    tr.appendChild(th1);
    let th2 = document.createElement("th")
    th2.style="width:200px"
    th2.textContent = "Режим работы"
    tr.appendChild(th2);
    let th3 = document.createElement("th")
    th3.textContent = "Время начала цикла"
    tr.appendChild(th3);
    let th4 = document.createElement("th")
    th4.textContent = "Время окончания цикла"
    tr.appendChild(th4);
    let th5 = document.createElement("th")
    th5.textContent = "Включено"
    tr.appendChild(th5);
    let th6 = document.createElement("th")
    th6.textContent = "Выключено"
    th6.style="width 200px"
    tr.appendChild(th6);
    let tbody = document.createElement("tbody")
    table.appendChild(tbody)
    let tr2 = document.createElement("tr")
    tbody.appendChild(tr2)
    config_window.appendChild(header);
    config_window.appendChild(table);
    console.log("FFFF")
    console.log(pwm_powers)
    for(let i = 0; i < count_of_cycles_in_device_moduls; i++){
      addRowToMechDevice(
        table.id,
        device_id,
        pwm_powers.split(',')[i],
        work_mode,
        cycle_begin.split(',')[i],
        cycle_end.split(',')[i],
        turn_on.split(',')[i],
        turn_off.split(',')[i]
      )
    }

    add_row_button.onclick = function (event){
      // addRowToMechDevice(table.id, device_id)
    }



  }
  // addMechDevice(1)
  function addRowToMechDevice(device_table_id, device_id){
    let tableRef = document.getElementById(device_table_id);
    // Insert a row in the table at row index 0
    let newRow = tableRef.insertRow(1);
    let newCell = newRow.insertCell(0);
    let newCell1 = newRow.insertCell(1);
    let newCell2 = newRow.insertCell(2);
    let newCell3 = newRow.insertCell(3);
    newCell3.style = "width: 100px"
    let newCell4 = newRow.insertCell(4);
    newCell4.style="width: 100px"
    let newCell5 = newRow.insertCell(5);
    newCell4.style="width: 100px"
    let pwd_select = document.createElement("select");
    pwd_select.id = 'pwd_input' + device_id.toString()
    let input1= document.createElement("input");
    let input2 = document.createElement("input");
    let select_time_on = document.createElement("select");
    let select_time_type_on = document.createElement("select");
    select_time_type_on.id = "time_type_select_on_" + device_id.toString()
    select_time_on.id = "time_select_on_" + device_id.toString()
    let select_time_off = document.createElement("select");
    let select_time_type_off = document.createElement("select");
    select_time_type_off.id = "time_type_select" + device_id.toString()
    select_time_off.id = "time_select" + device_id.toString()
    pwd_select.style="width: 50px"
    input1.style="width: 100px"
    input1.type="time"
    input2.style="width: 100px"
    input2.type="time"
    select_time_on.style="width: 50px"
    select_time_type_on.style="width: 50px"
    select_time_off.style="width: 50px"
    select_time_type_off.style="width: 50px"
    let working_mode_div = document.createElement("div");
    working_mode_div.style.display="flex"
    working_mode_div.style.alignItems="center"
    working_mode_div.style.flexDirection="column"
    let working_mode_text = document.createTextNode('Ручной');
    let working_mode_button = document.createElement("button");
    working_mode_button.innerHTML = "Изменить режим работы";
    working_mode_button.style.cssText = "      margin-top: 20px;\n" +
    "      background: #4C5DB8;\n" +
    "      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);\n" +
    "      border-radius: 15px;\n" +
    "      width: 200px;\n" +
    "      height: 39px;\n" +
    "      margin-left: 0px;";
    working_mode_button.addEventListener ("click", create_change_device_mode_window);
    working_mode_div.appendChild(working_mode_text);
    working_mode_div.appendChild(working_mode_button);
    newCell.appendChild(pwd_select)
    newCell1.appendChild(working_mode_div)
    newCell2.appendChild(input1)
    newCell3.appendChild(input2)
    newCell4.appendChild(select_time_on)
    newCell4.appendChild(select_time_type_on)
    newCell5.appendChild(select_time_off)
    newCell5.appendChild(select_time_type_off)
    fill_pwd_input(pwd_select.id)
    fill_time_input(select_time_on.id)
    fill_time_input(select_time_off.id)
    fill_time_type_input(select_time_type_on.id)
    fill_time_type_input(select_time_type_off.id)
    let register_device_window_height = document.getElementById("register_device_window").style.height;
    register_device_window_height=register_device_window_height.replace("px","");
    register_device_window_height =+ register_device_window_height;
    let n = register_device_window_height
    register_device_window_height = n + 50 + 'px';
    document.getElementById("register_device_window").style.height = register_device_window_height
  }
  // addRowToMechDevice('mech_device_table_1', 1)
  function showCurrentTime(value){ //установка текущего времени
    let dateControl = document.querySelector('input[type="datetime-local"]');
    dateControl.value = value;
  }

  showCurrentTime('2017-06-01T21:30');
  function saveSettings(){
    go_back()
  }
  function saveDeviceMode(){
    go_back_to_config_window()
  }
  function fill_time_input(input_id )
  {
    for (let i = 0; i <= 60; i++) {
      let z = document.getElementById(input_id);
      let option = document.createElement("option");
      option.value = i.toString();
      option.text = i.toString();
      z.appendChild(option);
      // register_devices.appendChild(option1);
    }
  }
  fill_time_input("system_time_value")
  fill_time_type_input("system_time_options")
  function fill_time_type_input(input_id )
  {
    let array = ["секунды","минуты","часы"];
    for (let i = 0; i < array.length; i++) {
      let z = document.getElementById(input_id);
      let option = document.createElement("option");
      option.value = array[i];
      option.text = array[i];
      z.appendChild(option);
      // register_devices.appendChild(option1);
    }
  }
  function fill_pwd_input(input_id )
  {
    for (let i = 0; i <= 100; i++) {
      let z = document.getElementById(input_id);
      let option = document.createElement("option");
      option.value = i.toString();
      option.text = i.toString();
      z.appendChild(option);
      // register_devices.appendChild(option1);
    }
  }
  // fill_time_input("time_values", "channel_time_values")
create_config_window()
</script>
</html>
